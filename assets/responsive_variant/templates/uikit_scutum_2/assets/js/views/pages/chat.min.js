var $chat=$("#sc-chat"),$submit=$("#sc-chat-message-submit"),$input=$("#sc-chat-message-input"),messages=[];scutum.pages.chat={},scutum.pages.chat.init=function(){$chat.addClass("sc-light"),scutum.pages.chat.message.fillChat(),scutum.pages.chat.message.send(),scutum.pages.chat.users()},scutum.pages.chat.message={fillChat:function(){scutum.require(["handlebars"],function(){$.when(scutum.handlebars.getPartial("chat-message"),scutum.helpers.ajax("data/pages/chat_messages.json","GET","json")).done(function(e,s){Handlebars.registerPartial("chat-message",e);var t=[];$.each(s,function(e,s){e<4?messages.push(s):t.push(s)}),$chat.one("render.handlebars",function(e,s){scutum.helpers.hiResImagesProcess()}).hbRender("chat-messages",{messages:messages}),setTimeout(function(){$chat.one("render.handlebars",function(e,s){$chat.find(".sc-sequence-show.sc-chat-messages-wrapper").each(function(e){var s=$(this);setTimeout(function(){scutum.helpers.sequenceShow.activate(s,"uk-animation-slide-left"),scutum.helpers.hiResImagesProcess()},200*(e+1))})}).hbRender("chat-messages",{messages:t,delayed:!0},!0)},1e3)})},!1)},send:function(){function s(){var e=scutum.helpers.escapeHTML($input.val()),t=$chat.find(".sc-chat-messages-wrapper").last(),a=function(){$input.val(""),$chat.parent(".optiscroll-content").length?$chat.closest("[data-sc-scrollbar]").data("optiscroll").scrollIntoView(t.find(".sc-chat-messages").children("li:last"),280,20):$chat.closest(".uk-card-body").scrollTop($chat[0].scrollHeight)};if(""!==e)if(t.hasClass("my")){var s=t.find("[data-message-time]:last").find("time").text(),c=moment().format("HH:mm");t.find(".sc-chat-messages").one("render.handlebars",function(e,s){scutum.helpers.sequenceShow.activate(t.find(".sc-sequence-show").last(),"uk-animation-slide-right"),a()}).hbRender("chat-message",{content:e,time:s!==c?moment().format("HH:mm"):"",animated:!0},!0)}else $chat.one("render.handlebars",function(e,s){scutum.helpers.sequenceShow.activate($chat.find(".sc-sequence-show").last(),"uk-animation-slide-right"),a()}).hbRender("chat-messages",{messages:[{id:scutum.helpers.uniqueID(),own:!0,messages:[{content:e,time:moment().format("HH:mm")}]}],delayed:!0},!0)}$submit.on("click",function(e){e.preventDefault(),s()}),$input.on("keyup",function(e){13===(event.which||event.keyCode)&&s()})}},scutum.pages.chat.users=function(){var e=$(".sc-js-chat-users-list");e.length&&e.children("li").on("click",function(){console.log("new chat window")})};