var URL=window.URL||window.webkitURL,$image=$("#sc-cropper-image"),$dataX=$("#sc-cropper-dataX"),$dataY=$("#sc-cropper-dataY"),$dataHeight=$("#sc-cropper-dataHeight"),$dataWidth=$("#sc-cropper-dataWidth"),$dataRotate=$("#sc-cropper-dataRotate"),$dataScaleX=$("#sc-cropper-dataScaleX"),$dataScaleY=$("#sc-cropper-dataScaleY"),options={aspectRatio:16/9,preview:".sc-cropper-preview",crop:function(a){$dataX.val(Math.round(a.detail.x)),$dataY.val(Math.round(a.detail.y)),$dataHeight.val(Math.round(a.detail.height)),$dataWidth.val(Math.round(a.detail.width)),$dataRotate.val(a.detail.rotate),$dataScaleX.val(a.detail.scaleX),$dataScaleY.val(a.detail.scaleY)}},$download=$("#sc-cropper-download");void 0===$download[0].download&&$download.addClass("disabled"),scutum.plugins.cropper={},scutum.plugins.cropper.init=function(){scutum.require(["cropper"],function(){scutum.plugins.cropper.initPlugin(),scutum.plugins.cropper.methods(),scutum.plugins.cropper.aspectRatio(),scutum.plugins.cropper.uploadImage()})},scutum.plugins.cropper.initPlugin=function(){$image.on({ready:function(a){},cropstart:function(a){},cropmove:function(a){},cropend:function(a){},crop:function(a){},zoom:function(a){}}).cropper(options)},scutum.plugins.cropper.aspectRatio=function(){$("[data-aspect-ratio]").on("click",function(){$(this).addClass("uk-active").siblings().removeClass("uk-active"),options.aspectRatio=$(this).attr("data-aspect-ratio"),$image.cropper("destroy").cropper(options)})},scutum.plugins.cropper.methods=function(){var a=$(".sc-cropper-buttons");a.find("button[data-method]").each(function(){UIkit.tooltip($(this))}),a.on("click","[data-method]",function(){var a,t,o,e,i=$(this),c=i.hasClass("sc-button-radio"),r=i.data(),p=$image.data("cropper"),s=$image.attr("src"),d="image/jpeg";if(!i.prop("disabled")&&!i.hasClass("disabled")&&p&&r.method){if(c&&(i.closest(".uk-button-group").find(".sc-button-radio").removeClass("uk-active"),i.addClass("uk-active")),void 0!==(r=$.extend({},r)).target&&(t=$(r.target),void 0===r.option))try{r.option=JSON.parse(t.val())}catch(a){console.log(a.message)}switch(a=p.cropped,r.method){case"rotate":a&&0<options.viewMode&&$image.cropper("clear");break;case"getCroppedCanvas":r.option||(r.option={}),r.option.fillColor="#fff"}switch(o=$image.cropper(r.method,r.option,r.secondOption),r.method){case"rotate":a&&0<options.viewMode&&$image.cropper("crop");break;case"scaleX":case"scaleY":$(this).data("option",-r.option);break;case"getCroppedCanvas":if(o){var n=$("#sc-getCroppedCanvasModal");UIkit.modal(n).show(),n.find(".uk-modal-body").html(o),$download.hasClass("disabled")||($download.download="cropped.jpg",$download.attr("href",o.toDataURL(d)))}break;case"destroy":e&&(URL.revokeObjectURL(e),e="",$image.attr("src",s))}if($.isPlainObject(o)&&t)try{t.val(JSON.stringify(o))}catch(a){console.log(a.message)}}})},scutum.plugins.cropper.uploadImage=function(){var o=$("#sc-cropper-inputImage");if(URL){var e;o.change(function(){var a,t=this.files;$image.data("cropper")&&t&&t.length&&(a=t[0],/^image\/\w+$/.test(a.type)?(a.name,a.type,e&&URL.revokeObjectURL(e),e=URL.createObjectURL(a),$image.cropper("destroy").attr("src",e).cropper(options),o.val("")):window.alert("Please choose an image file."))})}else o.prop("disabled",!0).parent().addClass("disabled")};